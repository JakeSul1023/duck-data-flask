{"ast":null,"code":"// loaders.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\n// This file is derived from the Cesium code base under Apache 2 license\n// See LICENSE.md and https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md\nimport { TILE3D_OPTIMIZATION_HINT, TILE_REFINEMENT } from \"../../constants.js\";\nimport { TilesetTraverser } from \"../tileset-traverser.js\";\nexport class Tileset3DTraverser extends TilesetTraverser {\n  compareDistanceToCamera(a, b) {\n    // Sort by farthest child first since this is going on a stack\n    return b._distanceToCamera === 0 && a._distanceToCamera === 0 ? b._centerZDepth - a._centerZDepth : b._distanceToCamera - a._distanceToCamera;\n  }\n  updateTileVisibility(tile, frameState) {\n    super.updateTileVisibility(tile, frameState);\n    //  Optimization - if none of the tile's children are visible then this tile isn't visible\n    if (!tile.isVisibleAndInRequestVolume) {\n      return;\n    }\n    const hasChildren = tile.children.length > 0;\n    if (tile.hasTilesetContent && hasChildren) {\n      // Use the root tile's visibility instead of this tile's visibility.\n      // The root tile may be culled by the children bounds optimization in which\n      // case this tile should also be culled.\n      const firstChild = tile.children[0];\n      this.updateTileVisibility(firstChild, frameState);\n      tile._visible = firstChild._visible;\n      return;\n    }\n    if (this.meetsScreenSpaceErrorEarly(tile, frameState)) {\n      tile._visible = false;\n      return;\n    }\n    const replace = tile.refine === TILE_REFINEMENT.REPLACE;\n    const useOptimization = tile._optimChildrenWithinParent === TILE3D_OPTIMIZATION_HINT.USE_OPTIMIZATION;\n    if (replace && useOptimization && hasChildren) {\n      if (!this.anyChildrenVisible(tile, frameState)) {\n        tile._visible = false;\n        return;\n      }\n    }\n  }\n  meetsScreenSpaceErrorEarly(tile, frameState) {\n    const {\n      parent\n    } = tile;\n    if (!parent || parent.hasTilesetContent || parent.refine !== TILE_REFINEMENT.ADD) {\n      return false;\n    }\n    // Use parent's geometric error with child's box to see if the tile already meet the SSE\n    return !this.shouldRefine(tile, frameState, true);\n  }\n}","map":{"version":3,"names":["TILE3D_OPTIMIZATION_HINT","TILE_REFINEMENT","TilesetTraverser","Tileset3DTraverser","compareDistanceToCamera","a","b","_distanceToCamera","_centerZDepth","updateTileVisibility","tile","frameState","isVisibleAndInRequestVolume","hasChildren","children","length","hasTilesetContent","firstChild","_visible","meetsScreenSpaceErrorEarly","replace","refine","REPLACE","useOptimization","_optimChildrenWithinParent","USE_OPTIMIZATION","anyChildrenVisible","parent","ADD","shouldRefine"],"sources":["C:/Users/jakes/Documents/GitHub/duck-data-flask/duck-data-webpage/node_modules/@loaders.gl/tiles/dist/tileset/format-3d-tiles/tileset-3d-traverser.js"],"sourcesContent":["// loaders.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\n// This file is derived from the Cesium code base under Apache 2 license\n// See LICENSE.md and https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md\nimport { TILE3D_OPTIMIZATION_HINT, TILE_REFINEMENT } from \"../../constants.js\";\nimport { TilesetTraverser } from \"../tileset-traverser.js\";\nexport class Tileset3DTraverser extends TilesetTraverser {\n    compareDistanceToCamera(a, b) {\n        // Sort by farthest child first since this is going on a stack\n        return b._distanceToCamera === 0 && a._distanceToCamera === 0\n            ? b._centerZDepth - a._centerZDepth\n            : b._distanceToCamera - a._distanceToCamera;\n    }\n    updateTileVisibility(tile, frameState) {\n        super.updateTileVisibility(tile, frameState);\n        //  Optimization - if none of the tile's children are visible then this tile isn't visible\n        if (!tile.isVisibleAndInRequestVolume) {\n            return;\n        }\n        const hasChildren = tile.children.length > 0;\n        if (tile.hasTilesetContent && hasChildren) {\n            // Use the root tile's visibility instead of this tile's visibility.\n            // The root tile may be culled by the children bounds optimization in which\n            // case this tile should also be culled.\n            const firstChild = tile.children[0];\n            this.updateTileVisibility(firstChild, frameState);\n            tile._visible = firstChild._visible;\n            return;\n        }\n        if (this.meetsScreenSpaceErrorEarly(tile, frameState)) {\n            tile._visible = false;\n            return;\n        }\n        const replace = tile.refine === TILE_REFINEMENT.REPLACE;\n        const useOptimization = tile._optimChildrenWithinParent === TILE3D_OPTIMIZATION_HINT.USE_OPTIMIZATION;\n        if (replace && useOptimization && hasChildren) {\n            if (!this.anyChildrenVisible(tile, frameState)) {\n                tile._visible = false;\n                return;\n            }\n        }\n    }\n    meetsScreenSpaceErrorEarly(tile, frameState) {\n        const { parent } = tile;\n        if (!parent || parent.hasTilesetContent || parent.refine !== TILE_REFINEMENT.ADD) {\n            return false;\n        }\n        // Use parent's geometric error with child's box to see if the tile already meet the SSE\n        return !this.shouldRefine(tile, frameState, true);\n    }\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA,SAASA,wBAAwB,EAAEC,eAAe,QAAQ,oBAAoB;AAC9E,SAASC,gBAAgB,QAAQ,yBAAyB;AAC1D,OAAO,MAAMC,kBAAkB,SAASD,gBAAgB,CAAC;EACrDE,uBAAuBA,CAACC,CAAC,EAAEC,CAAC,EAAE;IAC1B;IACA,OAAOA,CAAC,CAACC,iBAAiB,KAAK,CAAC,IAAIF,CAAC,CAACE,iBAAiB,KAAK,CAAC,GACvDD,CAAC,CAACE,aAAa,GAAGH,CAAC,CAACG,aAAa,GACjCF,CAAC,CAACC,iBAAiB,GAAGF,CAAC,CAACE,iBAAiB;EACnD;EACAE,oBAAoBA,CAACC,IAAI,EAAEC,UAAU,EAAE;IACnC,KAAK,CAACF,oBAAoB,CAACC,IAAI,EAAEC,UAAU,CAAC;IAC5C;IACA,IAAI,CAACD,IAAI,CAACE,2BAA2B,EAAE;MACnC;IACJ;IACA,MAAMC,WAAW,GAAGH,IAAI,CAACI,QAAQ,CAACC,MAAM,GAAG,CAAC;IAC5C,IAAIL,IAAI,CAACM,iBAAiB,IAAIH,WAAW,EAAE;MACvC;MACA;MACA;MACA,MAAMI,UAAU,GAAGP,IAAI,CAACI,QAAQ,CAAC,CAAC,CAAC;MACnC,IAAI,CAACL,oBAAoB,CAACQ,UAAU,EAAEN,UAAU,CAAC;MACjDD,IAAI,CAACQ,QAAQ,GAAGD,UAAU,CAACC,QAAQ;MACnC;IACJ;IACA,IAAI,IAAI,CAACC,0BAA0B,CAACT,IAAI,EAAEC,UAAU,CAAC,EAAE;MACnDD,IAAI,CAACQ,QAAQ,GAAG,KAAK;MACrB;IACJ;IACA,MAAME,OAAO,GAAGV,IAAI,CAACW,MAAM,KAAKpB,eAAe,CAACqB,OAAO;IACvD,MAAMC,eAAe,GAAGb,IAAI,CAACc,0BAA0B,KAAKxB,wBAAwB,CAACyB,gBAAgB;IACrG,IAAIL,OAAO,IAAIG,eAAe,IAAIV,WAAW,EAAE;MAC3C,IAAI,CAAC,IAAI,CAACa,kBAAkB,CAAChB,IAAI,EAAEC,UAAU,CAAC,EAAE;QAC5CD,IAAI,CAACQ,QAAQ,GAAG,KAAK;QACrB;MACJ;IACJ;EACJ;EACAC,0BAA0BA,CAACT,IAAI,EAAEC,UAAU,EAAE;IACzC,MAAM;MAAEgB;IAAO,CAAC,GAAGjB,IAAI;IACvB,IAAI,CAACiB,MAAM,IAAIA,MAAM,CAACX,iBAAiB,IAAIW,MAAM,CAACN,MAAM,KAAKpB,eAAe,CAAC2B,GAAG,EAAE;MAC9E,OAAO,KAAK;IAChB;IACA;IACA,OAAO,CAAC,IAAI,CAACC,YAAY,CAACnB,IAAI,EAAEC,UAAU,EAAE,IAAI,CAAC;EACrD;AACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}