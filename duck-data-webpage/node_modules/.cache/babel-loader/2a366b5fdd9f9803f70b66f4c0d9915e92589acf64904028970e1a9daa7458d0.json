{"ast":null,"code":"// loaders.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\nimport { Compression } from \"./compression.js\";\nimport { isBrowser, toArrayBuffer, promisify1 } from '@loaders.gl/loader-utils';\nimport pako from 'pako'; // https://bundlephobia.com/package/pako\nimport zlib from 'zlib';\n/**\n * DEFLATE compression / decompression\n */\nexport class DeflateCompression extends Compression {\n  name = 'deflate';\n  extensions = [];\n  contentEncodings = ['deflate'];\n  isSupported = true;\n  options;\n  _chunks = [];\n  constructor(options = {}) {\n    super(options);\n    this.options = options;\n  }\n  async compress(input) {\n    // On Node.js we can use built-in zlib\n    if (!isBrowser && this.options.deflate?.useZlib) {\n      const buffer = this.options.deflate?.gzip ? await promisify1(zlib.gzip)(input) : await promisify1(zlib.deflate)(input);\n      return toArrayBuffer(buffer);\n    }\n    return this.compressSync(input);\n  }\n  async decompress(input) {\n    // On Node.js we can use built-in zlib\n    if (!isBrowser && this.options.deflate?.useZlib) {\n      const buffer = this.options.deflate?.gzip ? await promisify1(zlib.gunzip)(input) : await promisify1(zlib.inflate)(input);\n      return toArrayBuffer(buffer);\n    }\n    return this.decompressSync(input);\n  }\n  compressSync(input) {\n    // On Node.js we can use built-in zlib\n    if (!isBrowser && this.options.deflate?.useZlib) {\n      const buffer = this.options.deflate?.gzip ? zlib.gzipSync(input) : zlib.deflateSync(input);\n      return toArrayBuffer(buffer);\n    }\n    const pakoOptions = this.options?.deflate || {};\n    const inputArray = new Uint8Array(input);\n    const deflate = this.options?.raw ? pako.deflateRaw : pako.deflate;\n    return deflate(inputArray, pakoOptions).buffer;\n  }\n  decompressSync(input) {\n    // On Node.js we can use built-in zlib\n    if (!isBrowser && this.options.deflate?.useZlib) {\n      const buffer = this.options.deflate?.gzip ? zlib.gunzipSync(input) : zlib.inflateSync(input);\n      return toArrayBuffer(buffer);\n    }\n    const pakoOptions = this.options?.deflate || {};\n    const inputArray = new Uint8Array(input);\n    const inflate = this.options?.raw ? pako.inflateRaw : pako.inflate;\n    return inflate(inputArray, pakoOptions).buffer;\n  }\n  async *compressBatches(asyncIterator) {\n    const pakoOptions = this.options?.deflate || {};\n    const pakoProcessor = new pako.Deflate(pakoOptions);\n    yield* this.transformBatches(pakoProcessor, asyncIterator);\n  }\n  async *decompressBatches(asyncIterator) {\n    const pakoOptions = this.options?.deflate || {};\n    const pakoProcessor = new pako.Inflate(pakoOptions);\n    yield* this.transformBatches(pakoProcessor, asyncIterator);\n  }\n  async *transformBatches(pakoProcessor, asyncIterator) {\n    pakoProcessor.onData = this._onData.bind(this);\n    pakoProcessor.onEnd = this._onEnd.bind(this);\n    for await (const chunk of asyncIterator) {\n      const uint8Array = new Uint8Array(chunk);\n      const ok = pakoProcessor.push(uint8Array, false); // false -> not last chunk\n      if (!ok) {\n        throw new Error(`${this._getError()}write`);\n      }\n      const chunks = this._getChunks();\n      yield* chunks;\n    }\n    // End\n    const emptyChunk = new Uint8Array(0);\n    const ok = pakoProcessor.push(emptyChunk, true); // true -> last chunk\n    if (!ok) {\n      // For some reason we get error but it still works???\n      // throw new Error(this._getError() + 'end');\n    }\n    const chunks = this._getChunks();\n    yield* chunks;\n  }\n  _onData(chunk) {\n    this._chunks.push(chunk);\n  }\n  _onEnd(status) {\n    if (status !== 0) {\n      throw new Error(this._getError(status) + this._chunks.length);\n    }\n  }\n  _getChunks() {\n    const chunks = this._chunks;\n    this._chunks = [];\n    return chunks;\n  }\n  // TODO - For some reason we don't get the error message from pako in _onEnd?\n  _getError(code = 0) {\n    const MESSAGES = {\n      /* Z_NEED_DICT       2  */\n      2: 'need dictionary',\n      /* Z_STREAM_END      1  */\n      1: 'stream end',\n      /* Z_OK              0  */\n      0: '',\n      /* Z_ERRNO         (-1) */\n      '-1': 'file error',\n      /* Z_STREAM_ERROR  (-2) */\n      '-2': 'stream error',\n      /* Z_DATA_ERROR    (-3) */\n      '-3': 'data error',\n      /* Z_MEM_ERROR     (-4) */\n      '-4': 'insufficient memory',\n      /* Z_BUF_ERROR     (-5) */\n      '-5': 'buffer error',\n      /* Z_VERSION_ERROR (-6) */\n      '-6': 'incompatible version'\n    };\n    return `${this.name}: ${MESSAGES[code]}`;\n  }\n}","map":{"version":3,"names":["Compression","isBrowser","toArrayBuffer","promisify1","pako","zlib","DeflateCompression","name","extensions","contentEncodings","isSupported","options","_chunks","constructor","compress","input","deflate","useZlib","buffer","gzip","compressSync","decompress","gunzip","inflate","decompressSync","gzipSync","deflateSync","pakoOptions","inputArray","Uint8Array","raw","deflateRaw","gunzipSync","inflateSync","inflateRaw","compressBatches","asyncIterator","pakoProcessor","Deflate","transformBatches","decompressBatches","Inflate","onData","_onData","bind","onEnd","_onEnd","chunk","uint8Array","ok","push","Error","_getError","chunks","_getChunks","emptyChunk","status","length","code","MESSAGES"],"sources":["C:/Users/jakes/Documents/GitHub/duck-data-flask/duck-data-webpage/node_modules/@loaders.gl/compression/dist/lib/deflate-compression.js"],"sourcesContent":["// loaders.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\nimport { Compression } from \"./compression.js\";\nimport { isBrowser, toArrayBuffer, promisify1 } from '@loaders.gl/loader-utils';\nimport pako from 'pako'; // https://bundlephobia.com/package/pako\nimport zlib from 'zlib';\n/**\n * DEFLATE compression / decompression\n */\nexport class DeflateCompression extends Compression {\n    name = 'deflate';\n    extensions = [];\n    contentEncodings = ['deflate'];\n    isSupported = true;\n    options;\n    _chunks = [];\n    constructor(options = {}) {\n        super(options);\n        this.options = options;\n    }\n    async compress(input) {\n        // On Node.js we can use built-in zlib\n        if (!isBrowser && this.options.deflate?.useZlib) {\n            const buffer = this.options.deflate?.gzip\n                ? await promisify1(zlib.gzip)(input)\n                : await promisify1(zlib.deflate)(input);\n            return toArrayBuffer(buffer);\n        }\n        return this.compressSync(input);\n    }\n    async decompress(input) {\n        // On Node.js we can use built-in zlib\n        if (!isBrowser && this.options.deflate?.useZlib) {\n            const buffer = this.options.deflate?.gzip\n                ? await promisify1(zlib.gunzip)(input)\n                : await promisify1(zlib.inflate)(input);\n            return toArrayBuffer(buffer);\n        }\n        return this.decompressSync(input);\n    }\n    compressSync(input) {\n        // On Node.js we can use built-in zlib\n        if (!isBrowser && this.options.deflate?.useZlib) {\n            const buffer = this.options.deflate?.gzip ? zlib.gzipSync(input) : zlib.deflateSync(input);\n            return toArrayBuffer(buffer);\n        }\n        const pakoOptions = this.options?.deflate || {};\n        const inputArray = new Uint8Array(input);\n        const deflate = this.options?.raw ? pako.deflateRaw : pako.deflate;\n        return deflate(inputArray, pakoOptions).buffer;\n    }\n    decompressSync(input) {\n        // On Node.js we can use built-in zlib\n        if (!isBrowser && this.options.deflate?.useZlib) {\n            const buffer = this.options.deflate?.gzip ? zlib.gunzipSync(input) : zlib.inflateSync(input);\n            return toArrayBuffer(buffer);\n        }\n        const pakoOptions = this.options?.deflate || {};\n        const inputArray = new Uint8Array(input);\n        const inflate = this.options?.raw ? pako.inflateRaw : pako.inflate;\n        return inflate(inputArray, pakoOptions).buffer;\n    }\n    async *compressBatches(asyncIterator) {\n        const pakoOptions = this.options?.deflate || {};\n        const pakoProcessor = new pako.Deflate(pakoOptions);\n        yield* this.transformBatches(pakoProcessor, asyncIterator);\n    }\n    async *decompressBatches(asyncIterator) {\n        const pakoOptions = this.options?.deflate || {};\n        const pakoProcessor = new pako.Inflate(pakoOptions);\n        yield* this.transformBatches(pakoProcessor, asyncIterator);\n    }\n    async *transformBatches(pakoProcessor, asyncIterator) {\n        pakoProcessor.onData = this._onData.bind(this);\n        pakoProcessor.onEnd = this._onEnd.bind(this);\n        for await (const chunk of asyncIterator) {\n            const uint8Array = new Uint8Array(chunk);\n            const ok = pakoProcessor.push(uint8Array, false); // false -> not last chunk\n            if (!ok) {\n                throw new Error(`${this._getError()}write`);\n            }\n            const chunks = this._getChunks();\n            yield* chunks;\n        }\n        // End\n        const emptyChunk = new Uint8Array(0);\n        const ok = pakoProcessor.push(emptyChunk, true); // true -> last chunk\n        if (!ok) {\n            // For some reason we get error but it still works???\n            // throw new Error(this._getError() + 'end');\n        }\n        const chunks = this._getChunks();\n        yield* chunks;\n    }\n    _onData(chunk) {\n        this._chunks.push(chunk);\n    }\n    _onEnd(status) {\n        if (status !== 0) {\n            throw new Error(this._getError(status) + this._chunks.length);\n        }\n    }\n    _getChunks() {\n        const chunks = this._chunks;\n        this._chunks = [];\n        return chunks;\n    }\n    // TODO - For some reason we don't get the error message from pako in _onEnd?\n    _getError(code = 0) {\n        const MESSAGES = {\n            /* Z_NEED_DICT       2  */\n            2: 'need dictionary',\n            /* Z_STREAM_END      1  */\n            1: 'stream end',\n            /* Z_OK              0  */\n            0: '',\n            /* Z_ERRNO         (-1) */\n            '-1': 'file error',\n            /* Z_STREAM_ERROR  (-2) */\n            '-2': 'stream error',\n            /* Z_DATA_ERROR    (-3) */\n            '-3': 'data error',\n            /* Z_MEM_ERROR     (-4) */\n            '-4': 'insufficient memory',\n            /* Z_BUF_ERROR     (-5) */\n            '-5': 'buffer error',\n            /* Z_VERSION_ERROR (-6) */\n            '-6': 'incompatible version'\n        };\n        return `${this.name}: ${MESSAGES[code]}`;\n    }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}