{"ast":null,"code":"// deck.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\nimport { PathLayer } from '@deck.gl/layers';\nimport { tripsUniforms } from \"./trips-layer-uniforms.js\";\nconst defaultProps = {\n  fadeTrail: true,\n  trailLength: {\n    type: 'number',\n    value: 120,\n    min: 0\n  },\n  currentTime: {\n    type: 'number',\n    value: 0,\n    min: 0\n  },\n  getTimestamps: {\n    type: 'accessor',\n    value: d => d.timestamps\n  }\n};\n/** Render animated paths that represent vehicle trips. */\nclass TripsLayer extends PathLayer {\n  getShaders() {\n    const shaders = super.getShaders();\n    shaders.inject = {\n      'vs:#decl': `\\\nin float instanceTimestamps;\nin float instanceNextTimestamps;\nout float vTime;\n`,\n      // Timestamp of the vertex\n      'vs:#main-end': `\\\nvTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;\n`,\n      'fs:#decl': `\\\nin float vTime;\n`,\n      // Drop the segments outside of the time window\n      'fs:#main-start': `\\\nif(vTime > trips.currentTime || (trips.fadeTrail && (vTime < trips.currentTime - trips.trailLength))) {\n  discard;\n}\n`,\n      // Fade the color (currentTime - 100%, end of trail - 0%)\n      'fs:DECKGL_FILTER_COLOR': `\\\nif(trips.fadeTrail) {\n  color.a *= 1.0 - (trips.currentTime - vTime) / trips.trailLength;\n}\n`\n    };\n    shaders.modules = [...shaders.modules, tripsUniforms];\n    return shaders;\n  }\n  initializeState() {\n    super.initializeState();\n    const attributeManager = this.getAttributeManager();\n    attributeManager.addInstanced({\n      timestamps: {\n        size: 1,\n        accessor: 'getTimestamps',\n        shaderAttributes: {\n          instanceTimestamps: {\n            vertexOffset: 0\n          },\n          instanceNextTimestamps: {\n            vertexOffset: 1\n          }\n        }\n      }\n    });\n  }\n  draw(params) {\n    const {\n      fadeTrail,\n      trailLength,\n      currentTime\n    } = this.props;\n    const tripsProps = {\n      fadeTrail,\n      trailLength,\n      currentTime\n    };\n    const model = this.state.model;\n    model.shaderInputs.setProps({\n      trips: tripsProps\n    });\n    super.draw(params);\n  }\n}\nTripsLayer.layerName = 'TripsLayer';\nTripsLayer.defaultProps = defaultProps;\nexport default TripsLayer;\n//# sourceMappingURL=trips-layer.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}