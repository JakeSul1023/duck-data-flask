{"ast":null,"code":"// luma.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\n/**\n * Helper class for using the legacy picking module\n */\nexport class LegacyPickingManager {\n  device;\n  framebuffer = null;\n  shaderInputs;\n  constructor(device, shaderInputs) {\n    this.device = device;\n    this.shaderInputs = shaderInputs;\n  }\n  destroy() {\n    this.framebuffer?.destroy();\n  }\n  getFramebuffer() {\n    if (!this.framebuffer) {\n      this.framebuffer = this.device.createFramebuffer({\n        colorAttachments: ['rgba8unorm'],\n        depthStencilAttachment: 'depth24plus'\n      });\n    }\n    return this.framebuffer;\n  }\n  /** Clear highlighted / picked object */\n  clearPickState() {\n    this.shaderInputs.setProps({\n      picking: {\n        highlightedObjectColor: null\n      }\n    });\n  }\n  /** Prepare for rendering picking colors */\n  beginRenderPass() {\n    const framebuffer = this.getFramebuffer();\n    framebuffer.resize(this.device.getCanvasContext().getPixelSize());\n    this.shaderInputs.setProps({\n      picking: {\n        isActive: true\n      }\n    });\n    const pickingPass = this.device.beginRenderPass({\n      framebuffer,\n      clearColor: [0, 0, 0, 0],\n      clearDepth: 1\n    });\n    return pickingPass;\n  }\n  updatePickState(mousePosition) {\n    const framebuffer = this.getFramebuffer();\n    // use the center pixel location in device pixel range\n    const [pickX, pickY] = this.getPickPosition(mousePosition);\n    // Read back\n    const color255 = this.device.readPixelsToArrayWebGL(framebuffer, {\n      sourceX: pickX,\n      sourceY: pickY,\n      sourceWidth: 1,\n      sourceHeight: 1\n    });\n    // console.log(color255);\n    // Check if we have\n    let highlightedObjectColor = [...color255].map(x => x / 255);\n    const isHighlightActive = highlightedObjectColor[0] + highlightedObjectColor[1] + highlightedObjectColor[2] > 0;\n    if (!isHighlightActive) {\n      highlightedObjectColor = null;\n    }\n    this.shaderInputs.setProps({\n      picking: {\n        isActive: false,\n        highlightedObjectColor\n      }\n    });\n  }\n  /**\n   * Get pick position in device pixel range\n   * use the center pixel location in device pixel range\n   */\n  getPickPosition(mousePosition) {\n    const devicePixels = this.device.getCanvasContext().cssToDevicePixels(mousePosition);\n    const pickX = devicePixels.x + Math.floor(devicePixels.width / 2);\n    const pickY = devicePixels.y + Math.floor(devicePixels.height / 2);\n    return [pickX, pickY];\n  }\n}","map":{"version":3,"names":["LegacyPickingManager","device","framebuffer","shaderInputs","constructor","destroy","getFramebuffer","createFramebuffer","colorAttachments","depthStencilAttachment","clearPickState","setProps","picking","highlightedObjectColor","beginRenderPass","resize","getCanvasContext","getPixelSize","isActive","pickingPass","clearColor","clearDepth","updatePickState","mousePosition","pickX","pickY","getPickPosition","color255","readPixelsToArrayWebGL","sourceX","sourceY","sourceWidth","sourceHeight","map","x","isHighlightActive","devicePixels","cssToDevicePixels","Math","floor","width","y","height"],"sources":["C:\\Users\\jakes\\Documents\\GitHub\\duck-data-flask\\duck-data-webpage\\node_modules\\@luma.gl\\engine\\src\\modules\\picking\\legacy-picking-manager.ts"],"sourcesContent":["// luma.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\n\nimport {Device, Framebuffer} from '@luma.gl/core';\nimport {picking} from '@luma.gl/shadertools';\nimport {ShaderInputs} from '../../shader-inputs';\nimport {NumberArray3} from '@math.gl/types';\n\n/**\n * Helper class for using the legacy picking module\n */\nexport class LegacyPickingManager {\n  device: Device;\n  framebuffer: Framebuffer | null = null;\n  shaderInputs: ShaderInputs<{picking: typeof picking.props}>;\n\n  constructor(device: Device, shaderInputs: ShaderInputs) {\n    this.device = device;\n    this.shaderInputs = shaderInputs as ShaderInputs<{picking: typeof picking.props}>;\n  }\n\n  destroy() {\n    this.framebuffer?.destroy();\n  }\n\n  getFramebuffer() {\n    if (!this.framebuffer) {\n      this.framebuffer = this.device.createFramebuffer({\n        colorAttachments: ['rgba8unorm'],\n        depthStencilAttachment: 'depth24plus'\n      });\n    }\n    return this.framebuffer;\n  }\n\n  /** Clear highlighted / picked object */\n  clearPickState() {\n    this.shaderInputs.setProps({picking: {highlightedObjectColor: null}});\n  }\n\n  /** Prepare for rendering picking colors */\n  beginRenderPass() {\n    const framebuffer = this.getFramebuffer();\n    framebuffer.resize(this.device.getCanvasContext().getPixelSize());\n\n    this.shaderInputs.setProps({picking: {isActive: true}});\n\n    const pickingPass = this.device.beginRenderPass({\n      framebuffer,\n      clearColor: [0, 0, 0, 0],\n      clearDepth: 1\n    });\n\n    return pickingPass;\n  }\n\n  updatePickState(mousePosition: [number, number]) {\n    const framebuffer = this.getFramebuffer();\n\n    // use the center pixel location in device pixel range\n    const [pickX, pickY] = this.getPickPosition(mousePosition);\n\n    // Read back\n    const color255 = this.device.readPixelsToArrayWebGL(framebuffer, {\n      sourceX: pickX,\n      sourceY: pickY,\n      sourceWidth: 1,\n      sourceHeight: 1\n    });\n    // console.log(color255);\n\n    // Check if we have\n    let highlightedObjectColor: NumberArray3 | null = [...color255].map(\n      x => x / 255\n    ) as NumberArray3;\n    const isHighlightActive =\n      highlightedObjectColor[0] + highlightedObjectColor[1] + highlightedObjectColor[2] > 0;\n\n    if (!isHighlightActive) {\n      highlightedObjectColor = null;\n    }\n\n    this.shaderInputs.setProps({\n      picking: {isActive: false, highlightedObjectColor}\n    });\n  }\n\n  /**\n   * Get pick position in device pixel range\n   * use the center pixel location in device pixel range\n   */\n  getPickPosition(mousePosition: number[]): [number, number] {\n    const devicePixels = this.device.getCanvasContext().cssToDevicePixels(mousePosition);\n    const pickX = devicePixels.x + Math.floor(devicePixels.width / 2);\n    const pickY = devicePixels.y + Math.floor(devicePixels.height / 2);\n    return [pickX, pickY];\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}