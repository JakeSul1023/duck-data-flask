{"ast":null,"code":"// loaders.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\n// Forked from https://github.com/mapbox/geojson-vt under compatible ISC license\n/**\n * Calculate simplification data using optimized Douglas-Peucker algorithm\n *\n * @param coords contiguous list of coordinates\n * @param first first coord to simplify\n * @param last last coord to simplify\n * @param sqTolerance tolerance (square distance)\n */\nexport function simplifyPath(coords, first, last, sqTolerance) {\n  let maxSqDist = sqTolerance;\n  const mid = last - first >> 1;\n  let minPosToMid = last - first;\n  let index;\n  const ax = coords[first];\n  const ay = coords[first + 1];\n  const bx = coords[last];\n  const by = coords[last + 1];\n  for (let i = first + 3; i < last; i += 3) {\n    const d = getSqSegDist(coords[i], coords[i + 1], ax, ay, bx, by);\n    if (d > maxSqDist) {\n      index = i;\n      maxSqDist = d;\n    } else if (d === maxSqDist) {\n      // a workaround to ensure we choose a pivot close to the middle of the list,\n      // reducing recursion depth, for certain degenerate inputs\n      // https://github.com/mapbox/geojson-vt/issues/104\n      const posToMid = Math.abs(i - mid);\n      if (posToMid < minPosToMid) {\n        index = i;\n        minPosToMid = posToMid;\n      }\n    }\n  }\n  if (maxSqDist > sqTolerance) {\n    if (index - first > 3) simplifyPath(coords, first, index, sqTolerance);\n    coords[index + 2] = maxSqDist;\n    if (last - index > 3) simplifyPath(coords, index, last, sqTolerance);\n  }\n}\n/** square distance from a point to a segment */\n// eslint-disable-next-line max-params\nfunction getSqSegDist(px, py, x, y, bx, by) {\n  let dx = bx - x;\n  let dy = by - y;\n  if (dx !== 0 || dy !== 0) {\n    const t = ((px - x) * dx + (py - y) * dy) / (dx * dx + dy * dy);\n    if (t > 1) {\n      x = bx;\n      y = by;\n    } else if (t > 0) {\n      x += dx * t;\n      y += dy * t;\n    }\n  }\n  dx = px - x;\n  dy = py - y;\n  return dx * dx + dy * dy;\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}